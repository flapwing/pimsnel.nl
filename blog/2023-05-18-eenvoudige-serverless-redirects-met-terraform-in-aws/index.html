<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><base href=https://pimsnel.nl/><title>Pim Snel</title><link href=https://pimsnel.nl/main.dc43b.css rel=stylesheet><link href=https://pimsnel.nl/style.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=https://pimsnel.nl/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://pimsnel.nl/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://pimsnel.nl/favicon-16x16.png><link rel=manifest href=https://pimsnel.nl/site.webmanifest><link rel=mask-icon href=https://pimsnel.nl/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href=https://pimsnel.nl/fonts.css rel=stylesheet><style>.debugprint_wrap{padding:20px;display:inline-block;margin:10px auto;border-radius:5px;border:2px solid #ddd}.debugprint td,.debugprint th{padding-left:4px;padding-right:4px}.debugprint th{border-bottom:1px solid #ddd;padding-bottom:10px;margin-bottom:10px}.debugprint tr{padding:5px 10px}.debugprint .key{font-weight:700}.debugprint .type{font-size:.9em;font-family:monospace;font-style:italic}.debugprint .value{font-family:monospace}.debugprint .true{color:green}.debugprint .false{color:red}.debugprint th.key,.debugprint th.type,.debugprint th.value{font-family:helvetica,arial,san-serif;text-transform:uppercase;letter-spacing:1px;font-size:1em;font-style:normal}</style><script async src=https://umami.pimsnel.com/script.js data-website-id=99c80dd8-368c-4502-b31a-41d3f1a6b769></script></head><body class="pimsnel-type-artikel pimsnel-kind-page"><div class=container-fluid><div class="row pimsnel-header"><div class=col-md-4></div><div class=col-md-4></div><div class=col-md-4></div></div></div><div class=container><div class="row pimsnel-header"><div class=col-6><a class=rodelink href=https://pimsnel.nl/blog/>&lt; terug naar blog</a></div><div class=col-6><div class="pimsnel-menu-icons float-right"><a href=https://pimsnel.nl/><i data-feather=home></i></a><a href=javascript:print()><i data-feather=printer></i></a></div></div></div></div><main aria-role=main><div class=container><div class=row><div class="col-md-8 offset-md-2"><h1 class=title>Serverless redirects</h1><div class="row pb-3"></div><time class=post-date datetime=2023-05-18T00:00:00Z>18 mei 2023</time>
<span class=float-right><a class=categories href=categories/aws>aws</a> <span class=categories>|</span> <a class=categories href=categories/terraform>terraform</a></span><h2 class=subtitle>Eenvoudige serverless redirects met Terraform in AWS.</h2><img class=header-image src=https://pimsnel.nl/blog/2023-05-18-eenvoudige-serverless-redirects-met-terraform-in-aws/imgs/seed_565023_00002.png class=img-responsive><div class="row pb-5"></div><div class=homepage-content><p>Het klinkt zo eenvoudig&mldr; Een website is verhuisd dus de oude locatie moet
doorverwijzen naar een nieuwe locatie. Technisch gezien is het ook niet zo heel
spannend, maar toch zijn er meerdere juist geconfigureerde componentjes nodig
om dit voor de gebruiker vlot te laten verlopen. In de oude wereld had je op
z&rsquo;n minst een webserver nodig. Deze tutorial laat je zien hoe je dit met
<a href=https://registry.terraform.io/modules/wearetechnative/module-url-redirect/aws/latest>TechNative&rsquo;s Terraform url-redirect
Module</a>
snel en eenvoudig in je AWS account kunt uitrollen.</p><p>Wat heb je er voor nodig:</p><ul><li>een beetje kennis van Terraform</li><li>een AWS Account</li><li>het oude domein moet als route53 zone in je AWS account aanwezig zijn.</li></ul><p>Stel je website draaide eerst op <a href=https://eerste-locatie.amsterdam>https://eerste-locatie.amsterdam</a> en inmiddels
draait je website op <a href=https://nieuwe-locatie.amsterdam>https://nieuwe-locatie.amsterdam</a>. Eerdere bezoekers hebben
nog bookmarks naar de oude locatie en ook op talloze plekken zullen nog links
naar de oude locatie aanwezig zijn. The &lsquo;internet never forgets&rsquo;</p><p>Om al deze oude links toch een eind bestemming bij jou nieuwe website te geven
willen we de situatie als volgt inregelen.</p><p>Als een eerdere bezoeker <code>nieuwe-locatie.amsterdam</code> in z&rsquo;n browser invoert zal de
browser denken dat hij naar <code>https://eerste-locatie.amsterdam</code> moet. De browser
zal een DNS query uitvoeren en wordt doorgestuurd naar een IP-adres waar een
webserver naar port 443 luistert. Hier zal de browser vragen om het SSL
certificaat dat hoort bij <code>eerste-locatie.amsterdam</code>. Pas als dit certificaat
deze geldig is beschouwd accepteert de browser de response van de webserver. De
webserver geeft in z&rsquo;n response de opdracht om in het vervolg direct de url
<code>https://nieuwe-locatie.amsterdam/we-zijn-verhuisd</code> te openen. Hier staat een
bericht dat de bezoeker uitlegt dat de website is voortaan op deze nieuwe plek
te bezoeken is.</p><p>Met AWS bouwstenen gaan we dit als volgt oplossen:</p><p>Een <em>Route53</em> record in de zone van <code>eerste-locatie.amsterdam</code> gaat verwijzen
naar een <em>CloudFfront</em> distributie. Deze CF distributie heeft een <em>ACM</em> SSL
certificaat gekoppeld dat bewijst dat <code>eerste-locatie.amsterdam</code> daadwerkelijk
in beheer is door de eigenaar van deze CloudFront resource. De <em>CloudFfront</em>
service stuurt alle <code>http</code> en <code>https</code> verzoeken door naar een als webserver
geconfigureerde <em>S3</em> bucket. Deze <em>S3</em> webserver stuurt vervolgens alle
browsers en web-agents door naar
<code>https://nieuwe-locatie.amsterdam/we-zijn-verhuisd</code></p><p>Samengevat gebruiken we deze AWS diensten:</p><ul><li><a href=https://aws.amazon.com/route53/>Route53</a></li><li><a href=https://aws.amazon.com/cloudfront/>CloudFront</a></li><li><a href=https://aws.amazon.com/certificate-manager/>AWS Certificate Manager</a></li><li><a href=https://aws.amazon.com/s3/>S3</a></li></ul><p>Ik ga niet helemaal uitleggen hoe je jouwe AWS account met Terraform
configureert. Bekijk <a href=https://developer.hashicorp.com/terraform/tutorials/aws-get-started>de tutorials op de website van de makers van
Terraform</a>
hoe je kunt beginnen. Als je een werkende setup hebt en je omgeving kan
aanpassen met <code>terraform apply</code> maak dan een nieuw bestand aan in je Terraform
codebase en voeg hier onderstaande code aan toe.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl>
<span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;redirect_technative_nl&#34;</span> {
  source  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;wearetechnative/module-url-redirect/aws&#34;</span>
  version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.1.1&#34;</span>
  domain                          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;technative.nl&#34;</span>
  route53_zone_name               <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;technative.nl.&#34;</span>

  providers <span style=color:#f92672>=</span> {
    <span style=color:#66d9ef>aws</span>.<span style=color:#66d9ef>us</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#66d9ef>east</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#66d9ef>aws</span>.<span style=color:#66d9ef>us</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#66d9ef>east</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#ae81ff>1</span>
  }

  redirect_target_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://technative.eu&#34;</span>
}
</code></pre></div><p>Als je deze TF code uitrolt zal het even duren omdat vooral het aanmaken van
een CloudFront distribute even duurt. Ook het valideren van de SSL certificaten
neemt wat tijd in beslag. Bovenstaand code blokken kun je voor
verschillende oude domeinnamen zoveel herhalen als je wilt.</p><p>Bedankt voor het lezen van deze tutorial. Mocht tegen problemen aanlopen, dan
horen we dit graag via ons <a href=https://github.com/wearetechnative/terraform-aws-module-url-redirect/issues>ticketsysteem op
github</a>.</p></div><p><a href="https://pimsnel.nl/pagina/reageer?artikel=Serverless%20redirects">Stuur me een reactie over dit artikel</a></p></div></div></div></main><div class=footer><img class=pim-linksonder src=https://pimsnel.nl/images/logo-pimsnel-com.png alt="logo Pim Snel"><div class=container-fluid><div class=col-sm-4>Â© 2019</div><div class=col-sm-4></div><div class=col-sm-4></div></div><img class=pim-rechtsonder src=https://pimsnel.nl/images/pim-rechtsonder.png alt="logo Pim Snel"></div><script src=https://pimsnel.nl/main.dc43b.js></script><script async defer data-website-id=70fae379-e1e5-4e9a-99cc-45bffd7a10f8 src=https://umami.poppygo.io/umami.js></script></body></html>